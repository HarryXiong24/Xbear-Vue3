# 基于 proxy 的响应式系统设计思路

1. 实现对 读取 和 设置 操作的代理拦截
2. 建立副作用函数与响应式数据的联系
3. 解决代理分支切换导致冗余副作用的问题，这里引入收集依赖的概念，在每一次副作用函数重新执行之前，清楚上一次建立响应依赖；当副作用函数重新执行后，又会再次建立起新的相应依赖。
4. 解决嵌套函数的副作用问题，这里采用副作用函数栈来存储不同的副作用函数。
5. 解决副作用函数无限递归调用自身，导致栈溢出的问题，原因在于对响应式数据的读取和设置操作发生在用一个副作用函数内，解决办法是如果 trigger 触发执行的副作用函数与当前正在执行的副作用函数相同，则不触发执行。
6. 实现响应系统的可调度性。通过 scheduler 选项指定调度。
7. 实现 computed，实际上是一个懒执行的副作用函数。当读取计算属性的值时，手动执行副作用函数即可。
8. 实现 watch，本质上利用了副作用函数重新执行时的可调度性。
9. 解决过期的副作用函数，导致的竞态问题。
10. 实现对属性 in 操作符的代理。
11. 实现对 for ... in ... 循环的代理。
12. 实现删除属性的代理。
13. 解决合理触发响应的细节问题。
14. 实现浅响应和深响应。
15. 实现浅只读和深只读
16. 代理数组。
17. 代理 Set 和 Map。
18. 代理原始值，这里引入了 ref 的概念。
